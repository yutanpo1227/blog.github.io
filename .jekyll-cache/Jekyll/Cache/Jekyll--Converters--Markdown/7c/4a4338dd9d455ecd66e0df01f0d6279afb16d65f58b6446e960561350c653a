I"O<p><img src="/blog.github.io/post-img/雑記/sushida/sushida.png" alt="寿司打" /></p>

<p>大学生活なんだか暇だったのでPythonで寿司打を自動化してみた！って話をします。<br />
ちなみに作ったのはかなり前なのでうろ覚えでこのブログ書いてます。<br /></p>
<h1 id="寿司打とは">寿司打とは</h1>
<p>まず初めに寿司打を知らない人向けに説明します。<br />
寿司打とは、有名なタイピングゲームで昔まではランキングがあってかなり競われていました。<br />
久しぶりに周りがやっていたのでやってみたらランキングが廃止されていたのでこれは自動化してもいいよね？？(かなりグレー)ということでやってみました。<br /></p>

<h1 id="環境">環境</h1>
<details open="">
  <summary><b>Python 3.8.2</b></summary>
  <ul>
    <li>selenium<br /></li>
    <li>pyautogui<br /></li>
    <li>opencv-python<br /></li>
    <li>numpy<br /></li>
    <li>mss<br /></li>
    <li>PIL<br /></li>
    <li>Pyocr<br /></li>
  </ul>
</details>

<h1 id="概略">概略</h1>
<p>コード全体を載っけるのは気がひけるため概略のみとさせていただきます。<br /></p>
<ol>
  <li>
    <p>seleniumで寿司打にアクセスする<br />
<img src="/blog.github.io/post-img/雑記/sushida/sushida.png" alt="寿司打" /></p>
  </li>
  <li>
    <p>難易度選択までクリックで進めスペースキー押下でゲームスタート(クリック位置は座標で指定)<br />
<img src="/blog.github.io/post-img/雑記/sushida/difficult.png" alt="寿司打" /></p>

    <p>(Macの場合なぜかpyautoguiの座標を半分の値にするとうまくいく)<br /></p>
  </li>
  <li>
    <p>ゲーム画面のスクリーンショットを取得し、文字位置だけを切り抜く<br />
<img src="/blog.github.io/post-img/雑記/sushida/screenshot.jpg" alt="寿司打" /></p>

    <p>スクリーンショットにはmssを用いている。<br />
 当初pyautoGUIのscreenshotを使っていたが、mssの方が圧倒的に高速で撮影できるためmssを使うことにした。<br /></p>
  </li>
  <li>
    <p>切り抜いた画像を二値化し色を反転する<br />
<img src="/blog.github.io/post-img/雑記/sushida/moji.jpg" alt="寿司打" /></p>

    <p>二値化した画像を色反転させることで文字を黒色にした方が文字認識がしやすい<br /></p>
  </li>
  <li>
    <p>Pyocr(tesseract)を使い文字認識を行い、文字列を取得する<br /></p>
  </li>
  <li>
    <p>取得した文字列をseleniumのsendkeysで入力する<br />
 pyautoguiのwrite関数よりも断然入力が早いためseleniumのsendkeysを使うことにした。<br /></p>
  </li>
  <li>
    <p>3~6を繰り返す<br /></p>
  </li>
</ol>

<p>以上の方法で寿司打を自動化することができました。<br /></p>

<h1 id="実際の動作">実際の動作</h1>

<p>結果はこんな感じです。<br />
<img src="/blog.github.io/post-img/雑記/sushida/result.png" alt="寿司打" /></p>

<p>実際に動いている動画は<span style="color: #00acee; "><a href="https://twitter.com/yuu_gakusei/status/1550387504591044608?s=20&amp;t=0R4DxDX7zrrpg1Y8_LMOAw">こちらのツイート</a></span>をご覧ください。<br /></p>

<p>実際に動かしてみると早すぎて時間が減るどころかボーナスの時間増加の方が多く無限に時間が増えていきます。<br />
ちなみに寿司打はなぜか340皿以上打とうとするとクラッシュするので340回でループを止めています。<br /></p>
:ET